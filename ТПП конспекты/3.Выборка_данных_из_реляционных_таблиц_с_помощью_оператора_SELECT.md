# Выборка данных из реляционных таблиц с помощью оператора SELECT

## Структура оператора SELECT

Для чтения данных из таблицы используется оператор SELECT. Этот оператор состоит из 6 предложений:

* В предложении SELECT перечисляются столбцы таблицы (или вычисляемые столбцы), которые должны быть выбраны;
* В предложении FROM указывается список таблиц, которые содержат указанные в части SELECT столбцы;
* В предложении WHERE указывается условие отбора строк, включаемых в результаты запроса;
* Предложение GROUP BY позволяет создавать итоговый запрос —  он группирует строки базы данных по указанному признаку, а затем включает в результаты запроса одну итоговую строку для каждой группы;
* Предложение HAVING содержит условие отбора для фильтрации сгрупированных строк;
* Предложение ORDER BY сортирует результаты запроса на основании данных, содержщихся в одном или нескольких столбцах.  

Зaпpoc может содержать вычисляемые столбцы, значения которых
определяются на основании значений, хранящихся в базе данных. Для этого в списке возвращаемых столбцов необходимо указать выражение. Выражения могут включать в себя операции сложения, вычитания, умножения и деления; также в различных СУБД реализованы дополнительные операции и функции.

Для выбора всех столбцов в предложении SELECT можно использовать символ '*'.

Повторяющиеся строки удаяются, если в предложении SELECT перед списком выбора указать ключевое слово DISTINCT.

## Отбор строк (WHERE)

Предложение WHERE состоит из ключевого слова WHERE, за которым следует условие отбора, определяющее, какие именно строки требуется извлечь. Если для строки условие отбора равно TRUE, то она включается в результат; если FALSE или NULL, то нет. Существует 5 основных условий отбора (предикатов):

* сравнение (=, <>, <, <=, >, >=);
* проверка на принадлежность диапазону (BETWEEN ... AND);
* проверка наличия во множестве (IN);
* проверка на соответствие шаблону (LIKE);
* проверка на равенство значению NULL (IS NULL).

## Сортировка результатов (ORDER BY)

Строки результатов запроса, как и строки таблицы базы данных, не имеют определенного порядка. Но, включив в инструкцию SELECT предложение ORDER ВУ, можно отсортировать результаты запроса. Это предложение содержит список имен или порядковых номеров столбцов, разделенных запятыми.

Первый указанный столбец является старшим ключом сортировки, следующие за ним — младшие ключи. 

По умолчанию происходит сортировка по возрастанию; для сортировки по убыванию следует добавить ключевое слово DESC.

Если столбец, по которому сортируется результат, является вычисляемым (не имеет имени), можно указать его порядковый номер.

## Соеднение таблиц

Процесс формирования пар строк путем сравнения содержимого соответствующих столбцов называется соединением таблиц. Получаемая в результате таблица, содержащая данные из обеих исходных таблиц, называется соединением (join) двух таблиц.

Для соединения таблиц используется ключевое слово JOIN в предложении FROM. Операция соединения в SQL комбинирует информацию из двух таблиц, формируя пары связанных строк из этих двух таблиц. Связанные столбцы, использующиеся при соединении, указаны в предложении ON, находящемся в конце предложения FROM.

### Внутреннее соединение

Внутреннее соединение (INNER JOIN) — включает все связанные строки двух таблиц; в каждую пару входят те строки из различных таблиц, у которых в связанных столбцах содержатся одинаковые значения.

### Внешнее соединение

Существует несколько типов внешнего соединения:

* Левое внешнее соединение (LEFT OUTER JOIN) включает все несвязанные строки первой (левой) таблицы, дополняя их значениями NULL, но не включает несвязанные строки второй (правой) таблицы;
* Правое внешнее соединение (RIGHT OUTER JOIN) включает все несвязанные строки второй (правой) таблицы, дополняя их значениями NULL, но не включает несвязанные строки первой (левой) таблицы;
* Полное внешнее соединение (FULL OUTER JOIN) включает все несвязанные строки обеих таблиц; оно симметрично по отношению к обеим таблицам.

## Запрос с группировкой (GROUP BY)

Запрос, включающий в себя предложение GROUP BY, называется запросом с группировкой, поскольку он объединяет строки исходных таблиц в группы и для каждой группы строк генерирует одну строку таблицы результатов запроса. 
Столбцы, указанные в предложении GROUP BY, называются столбцами группировки, поскольку именно они определяют, по какому признаку строки делятся на группы.

На запросы, в которых используется группировка, накладываются строгие ограничения.
Столбцы группировки должны представлять собой реальные столбцы таблиц, перечисленных в предложении FROM.
Кроме того, сущесrвуют ограничения на элементы списка возвращаемых столбцов.
Все элементы этого списка должны иметь одно значение для каждой группы строк.

Таким столбцом в запросе с группировкой может быть:

* один из столбцов группировки;
* константа;
* статистичекая функция, возвращающее одно значение для всех строк группы;
* столбец группировки, который по определению имеет одно и то же значение
во всех строках группы;
* выражение, включающее комбинацию перечисленных элементов.

На практике в список возвращаемых столбцов запроса с группировкой всегда
входят столбец группировки и статистическая функция.

## Условия отбора rpynn (HAVING)

Предложение HAVING определяет условие отбора групп строк. Его формат соответствует формату WHERE.

Используемое условие отбора должно применяться к группе в целом; элементом условия отбора может быть:

* константа;
* статистическая функция, возвращающая одно значение для всех строк, входящих в группу;
* столбец группировки, который по определению имеет одно и то же значение во всех строках группы;
* выражение, включающее в себя перечисленные выше элементы.

## Подзапросы

Подзапросом называется запрос внутри другого запроса SQL. Результаты подзапроса
используются СУБД для определения результатов запроса более высокого уровня, содержащего данный подзапрос.
Чаще всего подзапросы указываются в предложении WHERE инструкции SQL.
Подзапрос всегда заключается в круглые скобки, сохраняя при этом структуру инструкции
SELECT
Обычно результаты подзапроса состоят из одного столбца.
Предложение ORDER BY используется редко, так как результаты подзапроса используются внутри главного запроса и невидимы для пользователя.
Имена столбцов могут ссылаться на столбцы главного запроса.


&nbsp;
<hr>

> [Список вопросов](Вопросы_ТПП.md)