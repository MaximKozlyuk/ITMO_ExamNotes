# Режимы адресации процессора Intelx86

Режим адресации — это способ формирования исполнительного (эффективного) адреса операнда и результата на основе информации, содержащейся в адресной части команды. В большинстве случаев эффективный адрес требует преобразования в физический адрес с использованием механизма сегментации.

К основным режимам адресации относят следующие режимы:

1. Прямая адресация
    1. Прямая регистровая адресация
    2. Прямая адресация памяти
2. Относительная адресация
3. Косвенная адресация
4. Непосредственная адресация
5. Неявная адресация

 В первом байте кода операции первые 6 бит — это двоичный код операции, далее следует бит D — он задает направление, после — бит W, который задает размерность операции.

Режим адресации устанавливается во втором байте кода операции (постбайт адресации, он же байт mod r/m). Местоположение источника и приемника закодировано в полях REG и R/M. Если бит D = 1, то источник определяется полем R/M, приемник — полем REG; если D = 0, то наоборот. При W = 0 размерность данных — байт, при W = 1 — слово или двойное слово. Таким образом, команды, использующие постбайт адресации реализуют операции следующих типов:

* reg — reg (регистр — регистр)
* reg — mem (регистр — память)
* mem — reg (память — регистр)

## Поле MOD

Поле MOD определяет метод адресации и наличие смещения при адресации памяти. Код 11 означает регистровую адресацию, код регистра в поле R/M. При MOD = 00, 01, 10 поле R/M задает метод адресации памяти. 

Коды поля MOD:

* 00 — смещение отсутствует;
* 01 — смещение задано знаковым байтом;
* 10 — Смещение 16- или 32-х битное (в зависимости от режима);
* 11 — поле R/M содержит код регистра.

Коды регистров:

| Код | w = 0 (байт) | w = 1  (слово/двойное слово) |
|-----|--------------|------------------------------|
| 000 | AL           | AX/EAX                       |
| 001 | CL           | CX/ECX                       |
| 010 | DL           | DX/EDX                       |
| 011 | BL           | BX/EBX                       |
| 100 | AH           | SP/ESP                       |
| 101 | CH           | BP/EBP                       |
| 110 | DH           | SI/ESI                       |
| 111 | BH           | DI/EDI                       |



## Прямая адресация

При использовании прямой адресации в адресной части команды задается адрес операнда. Существует два вида прямой адресации:

* прямая регистровая адресация;
* прямая адресация памяти.

При прямой регистровой адресации поле MOD = 11, регистры источника и приемника определяются по кодам из полей REG и R/M по таблице выше.

При прямой адресации памяти происходит исключительный случай при MOD = 00, а поле R/M = 101 для 32-битного режима (в 16-битном режиме этот случай происходит при R/M = 110).

Пример прямой адресации памяти при пересылки данных из памяти в регистр:

```
.data
NUMB DD 0FFFFFFFFH

.code
MOV EDX, NUMB
```

Машинный код данной операции (32-битный режим):

```
8b 15 00 40 40 00
```

или 

```
10001011 00010101 00000000 01000000 01000000 00000000
```
 
 Здесь первый байт 8b (10001011) — код операции; первые 6 бит 100010 указывает на то, что выполняется команда MOV, бит D = 1, что означает, что приемник — регистр из поля REG, бит W = 1, что для 32-битного режима задает размерность данных 32 бит.

Следующий байт — постбайт адресации; поле mod = 00 (смещение отсутствует), reg = 010 (регистр-приемник EDX), r/m = 101 (прямая адресация 32-битного режима). 

Следующие 4 байта — адрес значения, помещаемого в регистр EDX.

&nbsp;
<hr>

> [Список вопросов](Вопросы_ТПП.md)